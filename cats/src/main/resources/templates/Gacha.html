<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cat's Matching</title>

<link href="/css/style.css" th:href="@{/css/style.css}" rel="stylesheet"></link>
<link href="/css/gacha.css" th:href="@{/css/gacha.css}" rel="stylesheet"></link>
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
	integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
	crossorigin="anonymous">
</head>
<body class="wrapper">


	<header>
		<div class="row">
			<div class="col-5">
				<a href=""> <img src="/img/rogo.jpg" width="150">
				</a>
			</div>
			<div class="col-5">
				<img src="/img/coin.png" width="50" class="pointImg"><p  th:text="${point}" class="point" ></p><p class="point" > ポイント</p>
			</div>
			<div class="col-2">
				<a th:href="@{/Logout}">ログアウト</a>
			</div>
		</div>
	</header>

	<div class="txt row">

		<div class="col-2">
			<a href=" " class="back"> 戻る </a>
		</div>
		<div class="col-8">きっかけガチャ</div>
		<div class="col-2"></div>
	</div>
	
		<div class=" border border-info explain">

		<p>※注意事項※</p>
		<br>
		<p>きっかけガチャは<font color="red">100ポイント</font>消費します</p>
		<br>
		<p>選択した趣味と一致した場合、相手にリクエストが送信されます</p>
		<p>相手がリクエストを<font color="red">許可</font>することでトークに追加されます</p>
		<br>
		<p>選択した趣味と一致する相手がいない場合、<font color="red">低確率</font>でポイント還元します</p>
		<p>(還元確率　300ポイント・・・10%　50ポイント・・・20%)</p>
		<br>
	
	</div>
	<font color="red"></font>
	<div class ="let"><p class = "h2"><font color="#7fffd4">L</font><font color="#C8FE2E">e</font><font color="EAADBD">t</font><font color="554562">'</font><font color="#D0A9F5">s</font> 
	<font color="#FF00BF">M</font><font color="#64FE2E">a</font><font color="#FA5858">t</font><font color="#00BFFF">c</font><font color="#D7DF01">h</font><font color="#5882FA">i</font><font color="red">n</font><font color="#FAAC58">g</font><font color="#A9F5BC">!</font></p></div>
	
	<div class="line"></div>
	<div th:if="${msg}">
		<p th:text="${msg}"class="errtext"></p>
	</div>
	<div class="center">
	<form class="input" th:action="@{/Gacha/Matching}" th:object="${gachabeans}"   method="get" enctype="multipart/form-data" >
		<input type="image" src="/img/gacha.jpeg" width="150" class="gacha-img">

		<div class="yoko">
		<select id="hobby" name="hobbyId" class="form-control" >
			<option th:value="0" class="pldown gacha-category">趣味を選択してください</option>
			<option th:each="dto:${hobbylist}" th:value="${dto.hobbyId}" th:text="${dto.hobbyName}" class="pldown gacha-category"></option>
		</select>
		</div>
	</form>

	</div>


	<div class="gacha-message fadeout center">
		<div class="img-box">
			<img src="/img/heart.png" alt="" class="img-heart img-fluid">
		</div>

	</div>

	<div th:if="${mode}">
	<input type="hidden" name="mode" value="update">
	</div>

	<div th:if="${pop}">
	<input type="hidden" name="pop" value="miss">
		<div class="modal fade " tabindex="-1" role="dialog"id="gacha">
	  <div class="modal-dialog" role="document"id="gacha">
	    <div class="modal-content login-first-msg "id="gacha">
	      <div class="modal-body"id="gacha">
	      		<p>マッチングに失敗しました！</p>
	      		<div th:if="${misspoint != 0 && misspoint == 300}">
				<p th:text="'大当たり！'+${misspoint}+'ポイント還元されました。'"></p>
				</div>
				<div th:if="${misspoint == 50 && misspoint !=0}">
				<p th:text="'当たり！'+${misspoint}+'ポイント還元されました。'"></p>
				</div>
	      </div>
	      <div class="text-center pb-3"id="gacha">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">閉じる</button>
	      </div>
	    </div>
	  </div>
	</div>
</div>


	<footer>
		<div class="row">
			<div class="col">
				<a th:href="@{/Home}"><img src="/img/ie.png"> </a>
			</div>
			<div class="col">
				<a th:href="@{/Board/Read}"><img src="/img/mrmo.png"> </a>
			</div>

			<div class="col">
				<a th:href="@{/Gacha/Top}"><img src="/img/hart.png"> </a>
			</div>

			<div class="col">
				<a th:href="@{/Talk/Select}"><img src="/img/fukidashi.png"> </a>
			</div>

			<div class="col">
				<a th:href="@{/Profile/View}"><img src="/img/hito.png"> </a>
			</div>

		</div>
	</footer>
</body>
</html>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
	integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
	crossorigin="anonymous"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
	integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
	crossorigin="anonymous"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
	integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
	crossorigin="anonymous"></script>


<script>
	var mode = document.querySelector('input[name="mode"]');
	var pop = document.querySelector('input[name="pop"]');
	//mode = null はそもそもあるかの判定
	if( mode != null && mode.value == 'update'){
		// ハートをフェードインで表示させる処理
		document.querySelector('.gacha-message').classList.remove('fadeout');
    	document.querySelector('.gacha-message').classList.add('fadein');

    	// ハート自体をクリックしたときにフェードアウトして消える処理
    	document.querySelector('.img-heart').onclick = function() {
    	  	document.querySelector('.gacha-message').classList.remove('fadein');
    	 	document.querySelector('.gacha-message').classList.add('fadeout');
    	}
	}
	//	追加
	else if( pop != null && pop.value == 'miss'){
		$('#gacha').modal('show')
	}

</script>

